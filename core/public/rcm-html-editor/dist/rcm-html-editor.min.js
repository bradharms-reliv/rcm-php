/*! rcm-html-editor 2019-04-09 */

var rcmHtmlEditorGuid={generate:function(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}()}},RcmHtmlEditorEventManager=function(){var self=this,events={};self.on=function(event,method){events[event]||(events[event]=[]),events[event].push(method)},self.trigger=function(event,args){events[event]&&jQuery.each(events[event],function(index,value){value(args)})}},RcmHtmlEditorService=function(eventManager){var self=this;self.eventManager=eventManager,self.isEditing=!1,self.toolbarLoading=!1,self.editorsLoading=[],self.editors={},self.hasEditors=!1,self.showFixedToolbar=!1,self.fixedToolbarToggle=!1,self.updateState=function(onUpdateComplete){var hasEditors=!1;for(var id in self.editors)self.editors[id].hasEditorInstance()&&(hasEditors=!0);self.hasEditors=hasEditors,"function"==typeof onUpdateComplete&&onUpdateComplete(self)},self.deleteEditor=function(id){delete self.editors[id],self.editors[id]&&(self.editors[id]=void 0)},self.getEditor=function(id){return self.editors[id]?self.editors[id]:null},self.hasEditorInstance=function(id){return!!self.editors[id]&&self.editors[id].hasEditorInstance()},self.loading=function(editorId,loading,msg){if(loading){var firstLoading=!1;0==self.editorsLoading.length&&(firstLoading=!0),self.editorsLoading.indexOf(editorId)<0&&(self.editorsLoading.push(editorId),self.toolbarLoading=self.editorsLoading.length>0,firstLoading&&self.eventManager.trigger("rcmHtmlEditorService.loading.start",{editorId:editorId,loading:self.editorsLoading}),self.eventManager.trigger("rcmHtmlEditorService.loading.change",{editorId:editorId,loading:self.editorsLoading,amount:1/(self.editorsLoading.length+1)}))}else self.editorsLoading.indexOf(editorId)>-1&&(self.editorsLoading.splice(self.editorsLoading.indexOf(editorId),1),self.toolbarLoading=self.editorsLoading.length>0,self.eventManager.trigger("rcmHtmlEditorService.loading.change",{editorId:editorId,loading:self.editorsLoading,amount:1/(self.editorsLoading.length+1)}),self.toolbarLoading||self.eventManager.trigger("rcmHtmlEditorService.loading.end",{editorId:editorId,loading:self.editorsLoading}))},self.eventManager.on("RcmHtmlEditor.onInit",function(args){self.loading(args.rcmHtmlEditor.id,!1,"rcmHtmlEditor: "),self.updateState(function(){args.rcmHtmlEditor.settings.fixed_toolbar&&(self.showFixedToolbar=!0)})}),self.eventManager.on("RcmHtmlEditor.onDestroy",function(rcmHtmlEditor){self.loading(rcmHtmlEditor.id,!1,"rcmHtmlEditor.onDestroy: "),self.updateState(function(){self.deleteEditor(rcmHtmlEditor.id)})})};angular.module("RcmHtmlEditor",[]).factory("rcmHtmlEditorConfig",function(){return rcmHtmlEditorConfig}).factory("rcmHtmlEditorEventManager",[function(){return new RcmHtmlEditorEventManager}]).factory("rcmHtmlEditorService",["rcmHtmlEditorEventManager",function(rcmHtmlEditorEventManager){return new RcmHtmlEditorService(rcmHtmlEditorEventManager)}]).factory("htmlEditorOptions",["rcmHtmlEditorConfig",function(rcmHtmlEditorConfig){return new RcmHtmlEditorOptions(rcmHtmlEditorConfig)}]).factory("guid",[function(){return rcmHtmlEditorGuid.generate}]).factory("rcmHtmlEditorFactory",["RcmHtmlEditor","rcmHtmlEditorService",function(RcmHtmlEditor,rcmHtmlEditorService){var self=this;return self.build=function(id,scope,elm,attrs,ngModel,settings){"object"!=typeof rcmHtmlEditorService.editors[id]&&(rcmHtmlEditorService.editors[id]=new RcmHtmlEditor(id,rcmHtmlEditorService),rcmHtmlEditorService.loading(id,!0,"rcmHtmlEditorInit"),rcmHtmlEditorService.editors[id].init(scope,elm,attrs,ngModel,settings))},self.destroy=function(id){console.log("destroy",id),"object"==typeof rcmHtmlEditorService.editors[id]&&rcmHtmlEditorService.editors[id].destroy()},self}]).factory("RcmHtmlEditor",["rcmHtmlEditorService",function(rcmHtmlEditorService){return RcmHtmlEditor}]).factory("rcmHtmlEditorInit",["guid","htmlEditorOptions","rcmHtmlEditorService","rcmHtmlEditorFactory",function(guid,htmlEditorOptions,rcmHtmlEditorService,rcmHtmlEditorFactory){return function(scope,elm,attrs,ngModel,config){attrs.id||attrs.$set("id",guid());var id=attrs.id,settings=htmlEditorOptions.buildHtmlOptions(id,scope,attrs,config);rcmHtmlEditorFactory.build(id,scope,elm,attrs,ngModel,settings)}}]).factory("rcmHtmlEditorDestroy",["rcmHtmlEditorService","rcmHtmlEditorFactory",function(rcmHtmlEditorService,rcmHtmlEditorFactory){return function(id){id&&rcmHtmlEditorFactory.destroy(id)}}]).directive("rcmHtmlEdit",["rcmHtmlEditorInit",function(rcmHtmlEditorInit){var self=this;return self.compile=function(tElm,tAttr){return function(scope,elm,attrs,ngModel,config){rcmHtmlEditorInit(scope,elm,attrs,ngModel,config)}},{compile:self.compile,priority:10,require:"?ngModel",restrict:"AE"}}]).directive("rcmHtmlEditOnClick",["$parse","rcmHtmlEditorInit",function($parse,rcmHtmlEditorInit){var self=this;return self.compile=function(tElm,tAttr){return function(scope,elm,attrs,ngModel,config){var clickElm=elm;if(attrs.rcmHtmlEditOnClick){var selector=$parse(attrs.rcmHtmlEditOnClick)(scope),parentElm=elm.parent(),newElm=parentElm.find(selector).first();newElm&&(clickElm=newElm)}clickElm.click(function(){rcmHtmlEditorInit(scope,elm,attrs,ngModel,config)})}},{compile:self.compile,priority:10,require:"?ngModel",restrict:"AE"}}]).directive("htmlEditorToolbar",["rcmHtmlEditorService",function(rcmHtmlEditorService){var toolbar=new RcmHtmlEditorToolbar(rcmHtmlEditorService),directive=toolbar.getDirective();return directive.restrict="AE",directive}]),"undefined"!=typeof rcm&&rcm.addAngularModule("RcmHtmlEditor");
//# sourceMappingURL=rcm-html-editor.min.js.map